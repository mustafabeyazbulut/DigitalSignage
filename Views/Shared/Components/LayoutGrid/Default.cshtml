@model DigitalSignage.ViewModels.DynamicLayoutViewModel

@{
    DigitalSignage.Models.LayoutDefinitionModel? def = null;
    try
    {
        def = System.Text.Json.JsonSerializer.Deserialize<DigitalSignage.Models.LayoutDefinitionModel>(
            Model.LayoutDefinition ?? "{}",
            new System.Text.Json.JsonSerializerOptions { PropertyNameCaseInsensitive = true });
    }
    catch { }
}

@if (def?.Rows != null)
{
    <div class="layout-grid" style="display:flex;flex-direction:column;gap:6px;min-height:400px;border:2px solid #dee2e6;padding:6px;border-radius:8px;">
        @foreach (var row in def.Rows)
        {
            var colTemplate = string.Join(" ", row.Columns?.Select(c => c.Width + "fr") ?? Array.Empty<string>());
            <div style="display:grid;grid-template-columns:@colTemplate;gap:6px;flex:@row.Height;">
                @if (row.Columns != null)
                {
                    var rowIdx = def.Rows.IndexOf(row);
                    var colIdx = 0;
                    @foreach (var col in row.Columns)
                    {
                        var sectionPos = $"R{rowIdx + 1}C{colIdx + 1}";
                        var matchedSection = Model.Sections.FirstOrDefault(s => s.Position == sectionPos);
                        <div class="grid-section" style="background-color:#f8f9fa;border:1px solid #dee2e6;padding:15px;border-radius:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
                            <h5 class="mb-1">@sectionPos</h5>
                            @if (matchedSection != null)
                            {
                                <small class="text-muted">@matchedSection.SectionID</small>
                            }
                        </div>
                        colIdx++;
                    }
                }
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-warning">Invalid layout definition</div>
}
